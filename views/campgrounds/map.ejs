<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Add a marker using a place name</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
<style>
	body { margin: 0; padding: 0; }
	#map{ position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
	<h1 id="location" style="display:none">
		<%=campground.location%>
	</h1>
	<div id="onmap" style="top:0;right:0"></div>
	
	<!-- <h1 id="location" style="display:none"></h1> -->
<div id="map"></div>
<script src="https://unpkg.com/es6-promise@4.2.4/dist/es6-promise.auto.min.js"></script>
<script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
<script>
	
	var info = document.getElementById("location");
	var r = info.innerHTML;
	// console.log(r);
	mapboxgl.accessToken = "pk.eyJ1Ijoic3VkaGFyc2hhbjI0IiwiYSI6ImNrZTJnejZmbjA5YTQzN243dHlrNnZiM2wifQ.ogBVUqSnb2E9Mty-95LVXw";
    var mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });
	    mapboxClient.geocoding
        .forwardGeocode({
            query: r,
            autocomplete: false,
            limit: 1
        })
        .send()
        .then(function(response) {
			console.log(response);
            if (
                response &&
                response.body &&
                response.body.features &&
                response.body.features.length
            ) {
                var feature = response.body.features[0];			
            var long = response.body.features[0].center[0];
            var lat = response.body.features[0].center[1];
		
		var m = "<h3><a href=https://www.google.com/search?q=" + response.body.query[0] + " target='_blank'>View more information</a></h3>";
                var map = new mapboxgl.Map({
                     container: 'map',           
                    style: 'mapbox://styles/mapbox/streets-v11',
                    center: feature.center,
                    zoom: 10
                });
                new mapboxgl.Marker().setLngLat(feature.center).addTo(map);	
				map.on("click",function(e){
				    var popup = new mapboxgl.Popup({ closeOnClick: false })
					.setLngLat([long,lat])
					.setHTML(m)
					.addTo(map);
			}) 
			} });
	
</script>
	
</body>
</html>